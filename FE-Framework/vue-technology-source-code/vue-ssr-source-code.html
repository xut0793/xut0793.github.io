<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue-server-renderer 源码解析 | xut0793's blog</title>
    <meta name="description" content="个人知识框架整理，便于查缺漏。前端 HTML CSS ES TS Vue React Node Express Koa">
    <link rel="stylesheet" href="/assets/style.1a961a38.css">
    <link rel="modulepreload" href="/assets/app.f1e974b0.js">
    <link rel="modulepreload" href="/assets/FE-Framework_vue-technology-source-code_vue-ssr-source-code.md.204e79ea.lean.js">
    
    <meta name="twitter:title" content="vue-server-renderer 源码解析 | xut0793&#39;s blog">
  <meta property="og:title" content="vue-server-renderer 源码解析 | xut0793&#39;s blog">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-2ba227d5><div class="sidebar-button" data-v-2ba227d5><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="xut0793&#39;s blog, back to home" data-v-2ba227d5 data-v-b3da5816><!----> xut0793&#39;s blog</a><div class="flex-grow" data-v-2ba227d5></div><div class="nav" data-v-2ba227d5><nav class="nav-links" data-v-2ba227d5 data-v-0fce24fe><!--[--><div class="item" data-v-0fce24fe><div class="nav-link" data-v-0fce24fe data-v-2cb643ba><a class="item" href="/Design/" data-v-2cb643ba>设计 <!----></a></div></div><div class="item" data-v-0fce24fe><div class="nav-dropdown-link" data-v-0fce24fe data-v-8afceaa4><button class="button" data-v-8afceaa4><span class="button-text" data-v-8afceaa4>前端语言</span><span class="right button-arrow" data-v-8afceaa4></span></button><ul class="dialog" data-v-8afceaa4><!--[--><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Language/HTML/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>HTML</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Language/CSS/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>CSS</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Language/ES/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>ES</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Language/TS/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>TS</span><span class="icon" data-v-26978090><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-0fce24fe><div class="nav-dropdown-link" data-v-0fce24fe data-v-8afceaa4><button class="button" data-v-8afceaa4><span class="button-text" data-v-8afceaa4>前端框架</span><span class="right button-arrow" data-v-8afceaa4></span></button><ul class="dialog" data-v-8afceaa4><!--[--><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>UI组件库</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Framework/Element-UI/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Element-UI</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>Web端</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Framework/Vue/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Vue技术栈</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item active" href="/FE-Framework/vue-technology-source-code" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Vue技术栈源码</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Framework/React/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>React技术栈</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><!--]--></ul></div></div><div class="item" data-v-0fce24fe><div class="nav-dropdown-link" data-v-0fce24fe data-v-8afceaa4><button class="button" data-v-8afceaa4><span class="button-text" data-v-8afceaa4>前端工程化</span><span class="right button-arrow" data-v-8afceaa4></span></button><ul class="dialog" data-v-8afceaa4><!--[--><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/intro-fe-engineering" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>概念理解</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>初始化</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/initial/dev-env" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>配置环境</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/initial/cli" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>脚手架CLI</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/initial/project-directory" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>工程目录</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/initial/package-json" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>package.json</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/initial/browserslist" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>browserslist</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>开发DEV</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/dev-server" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>本地服务</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/dev-linter/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>开发规范</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/dev-mock/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>mock环境</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/dev-test/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>测试</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/dev-debug" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>调试</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>构建CI</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/ci-babel/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Babel</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/ci-postcss/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Postcss</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/ci-webpack/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Webapck</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/ci-rollup" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>rollup</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/ci-vite/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>vite</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/ci-gulp/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>gulp</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/ci-run-script/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>run-script</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>部署CD</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/cd-deploy/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>自动化部署</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/cd-release/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>发布策略</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>运维OP</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/op-monitor/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>数据监控</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/op-performance/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>性能优化</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><!--]--></ul></div></div><div class="item" data-v-0fce24fe><div class="nav-dropdown-link" data-v-0fce24fe data-v-8afceaa4><button class="button" data-v-8afceaa4><span class="button-text" data-v-8afceaa4>前端技术方向</span><span class="right button-arrow" data-v-8afceaa4></span></button><ul class="dialog" data-v-8afceaa4><!--[--><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Technology/responsive-web-design" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>响应式网页设计</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Technology/backend-for-frontend" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>BFF</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>微前端</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Technology/micro-frontend/intro-micro-fe" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>微前端概念</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Technology/micro-frontend/qiankun" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>qiankun</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Technology/micro-frontend/monorepo" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>monorepo工程</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Technology/micro-frontend/lerna" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>lerna</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>可视化</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Technology/visualize/svg/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>SVG</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Technology/visualize/canvas/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Canvas</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Technology/visualize/webgl/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>WebGl</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><!--]--></ul></div></div><div class="item" data-v-0fce24fe><div class="nav-dropdown-link" data-v-0fce24fe data-v-8afceaa4><button class="button" data-v-8afceaa4><span class="button-text" data-v-8afceaa4>浏览器</span><span class="right button-arrow" data-v-8afceaa4></span></button><ul class="dialog" data-v-8afceaa4><!--[--><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Browser/1-BOM/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>BOM</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Browser/2-DOM/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>DOM</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Browser/3-CSSOM/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>CSSOM</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Browser/4-render/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>渲染</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Browser/5-cache/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>缓存</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Browser/6-storage/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>本地存储</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Browser/7-security/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>安全</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Browser/8-new-api/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>新API</span><span class="icon" data-v-26978090><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-0fce24fe><div class="nav-dropdown-link" data-v-0fce24fe data-v-8afceaa4><button class="button" data-v-8afceaa4><span class="button-text" data-v-8afceaa4>网络</span><span class="right button-arrow" data-v-8afceaa4></span></button><ul class="dialog" data-v-8afceaa4><!--[--><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>网络协议</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Network/protocol/index" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>HTTP</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Network/protocol/tcp-udp" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>TCP/UDP</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Network/protocol/dns" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>DNS</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>网络通信</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Network/XMLHttpRequest" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>XMLHttpRequest</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Network/axios/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Axios</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Network/fetch/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Fetch</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Network/EventSource" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>EventSource</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Network/websocket" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>WebSocket</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>接口规范</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Network/restful/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>RESTful</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Network/graphql/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>GraphQL</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><!--]--></ul></div></div><div class="item" data-v-0fce24fe><div class="nav-dropdown-link" data-v-0fce24fe data-v-8afceaa4><button class="button" data-v-8afceaa4><span class="button-text" data-v-8afceaa4>服务端</span><span class="right button-arrow" data-v-8afceaa4></span></button><ul class="dialog" data-v-8afceaa4><!--[--><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Server/node/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Node</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Server/connect/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Connect</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Server/express/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Express</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Server/koa/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Koa</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Server/nest/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Nest</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Server/bash/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Bash</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Server/nginx/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Nginx</span><span class="icon" data-v-26978090><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-0fce24fe><div class="nav-dropdown-link" data-v-0fce24fe data-v-8afceaa4><button class="button" data-v-8afceaa4><span class="button-text" data-v-8afceaa4>数据库</span><span class="right button-arrow" data-v-8afceaa4></span></button><ul class="dialog" data-v-8afceaa4><!--[--><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Database/mysql/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>MySQL</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Database/mongodb/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>MongoDB</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Database/redis/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Redis</span><span class="icon" data-v-26978090><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-0fce24fe><div class="nav-dropdown-link" data-v-0fce24fe data-v-8afceaa4><button class="button" data-v-8afceaa4><span class="button-text" data-v-8afceaa4>软件知识</span><span class="right button-arrow" data-v-8afceaa4></span></button><ul class="dialog" data-v-8afceaa4><!--[--><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Software/data-structure/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>数据结构</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Software/algorithm/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>算法</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Software/design-pattern/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>设计模式</span><span class="icon" data-v-26978090><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-0fce24fe><div class="nav-dropdown-link" data-v-0fce24fe data-v-8afceaa4><button class="button" data-v-8afceaa4><span class="button-text" data-v-8afceaa4>工具</span><span class="right button-arrow" data-v-8afceaa4></span></button><ul class="dialog" data-v-8afceaa4><!--[--><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Tools/git/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Git</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Tools/vscode/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Vscode</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Tools/vim/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Vim</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Tools/window-terminal" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Window Terminal</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Tools/powershell" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Powershell</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Tools/node-tree-cli" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>node-tree-cli</span><span class="icon" data-v-26978090><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-0fce24fe><div class="nav-link" data-v-0fce24fe data-v-2cb643ba><a class="item" href="/Books/" data-v-2cb643ba>已阅书籍 <!----></a></div></div><!--]--><!----><div class="item" data-v-0fce24fe><div class="nav-link" data-v-0fce24fe data-v-2cb643ba><a class="item isExternal" href="https://github.com/xutao0793/blog" target="_blank" rel="noopener noreferrer" data-v-2cb643ba>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-2cb643ba><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-79af364c><nav class="nav-links nav" data-v-79af364c data-v-0fce24fe><!--[--><div class="item" data-v-0fce24fe><div class="nav-link" data-v-0fce24fe data-v-2cb643ba><a class="item" href="/Design/" data-v-2cb643ba>设计 <!----></a></div></div><div class="item" data-v-0fce24fe><div class="nav-dropdown-link" data-v-0fce24fe data-v-8afceaa4><button class="button" data-v-8afceaa4><span class="button-text" data-v-8afceaa4>前端语言</span><span class="right button-arrow" data-v-8afceaa4></span></button><ul class="dialog" data-v-8afceaa4><!--[--><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Language/HTML/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>HTML</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Language/CSS/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>CSS</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Language/ES/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>ES</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Language/TS/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>TS</span><span class="icon" data-v-26978090><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-0fce24fe><div class="nav-dropdown-link" data-v-0fce24fe data-v-8afceaa4><button class="button" data-v-8afceaa4><span class="button-text" data-v-8afceaa4>前端框架</span><span class="right button-arrow" data-v-8afceaa4></span></button><ul class="dialog" data-v-8afceaa4><!--[--><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>UI组件库</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Framework/Element-UI/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Element-UI</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>Web端</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Framework/Vue/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Vue技术栈</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item active" href="/FE-Framework/vue-technology-source-code" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Vue技术栈源码</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Framework/React/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>React技术栈</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><!--]--></ul></div></div><div class="item" data-v-0fce24fe><div class="nav-dropdown-link" data-v-0fce24fe data-v-8afceaa4><button class="button" data-v-8afceaa4><span class="button-text" data-v-8afceaa4>前端工程化</span><span class="right button-arrow" data-v-8afceaa4></span></button><ul class="dialog" data-v-8afceaa4><!--[--><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/intro-fe-engineering" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>概念理解</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>初始化</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/initial/dev-env" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>配置环境</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/initial/cli" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>脚手架CLI</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/initial/project-directory" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>工程目录</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/initial/package-json" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>package.json</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/initial/browserslist" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>browserslist</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>开发DEV</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/dev-server" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>本地服务</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/dev-linter/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>开发规范</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/dev-mock/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>mock环境</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/dev-test/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>测试</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/dev-debug" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>调试</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>构建CI</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/ci-babel/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Babel</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/ci-postcss/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Postcss</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/ci-webpack/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Webapck</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/ci-rollup" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>rollup</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/ci-vite/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>vite</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/ci-gulp/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>gulp</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/ci-run-script/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>run-script</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>部署CD</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/cd-deploy/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>自动化部署</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/cd-release/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>发布策略</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>运维OP</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/op-monitor/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>数据监控</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Engineering/op-performance/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>性能优化</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><!--]--></ul></div></div><div class="item" data-v-0fce24fe><div class="nav-dropdown-link" data-v-0fce24fe data-v-8afceaa4><button class="button" data-v-8afceaa4><span class="button-text" data-v-8afceaa4>前端技术方向</span><span class="right button-arrow" data-v-8afceaa4></span></button><ul class="dialog" data-v-8afceaa4><!--[--><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Technology/responsive-web-design" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>响应式网页设计</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Technology/backend-for-frontend" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>BFF</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>微前端</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Technology/micro-frontend/intro-micro-fe" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>微前端概念</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Technology/micro-frontend/qiankun" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>qiankun</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Technology/micro-frontend/monorepo" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>monorepo工程</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Technology/micro-frontend/lerna" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>lerna</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>可视化</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Technology/visualize/svg/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>SVG</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Technology/visualize/canvas/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Canvas</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/FE-Technology/visualize/webgl/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>WebGl</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><!--]--></ul></div></div><div class="item" data-v-0fce24fe><div class="nav-dropdown-link" data-v-0fce24fe data-v-8afceaa4><button class="button" data-v-8afceaa4><span class="button-text" data-v-8afceaa4>浏览器</span><span class="right button-arrow" data-v-8afceaa4></span></button><ul class="dialog" data-v-8afceaa4><!--[--><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Browser/1-BOM/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>BOM</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Browser/2-DOM/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>DOM</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Browser/3-CSSOM/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>CSSOM</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Browser/4-render/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>渲染</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Browser/5-cache/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>缓存</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Browser/6-storage/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>本地存储</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Browser/7-security/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>安全</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Browser/8-new-api/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>新API</span><span class="icon" data-v-26978090><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-0fce24fe><div class="nav-dropdown-link" data-v-0fce24fe data-v-8afceaa4><button class="button" data-v-8afceaa4><span class="button-text" data-v-8afceaa4>网络</span><span class="right button-arrow" data-v-8afceaa4></span></button><ul class="dialog" data-v-8afceaa4><!--[--><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>网络协议</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Network/protocol/index" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>HTTP</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Network/protocol/tcp-udp" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>TCP/UDP</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Network/protocol/dns" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>DNS</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>网络通信</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Network/XMLHttpRequest" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>XMLHttpRequest</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Network/axios/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Axios</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Network/fetch/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Fetch</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Network/EventSource" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>EventSource</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Network/websocket" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>WebSocket</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><li class="dialog-item" data-v-8afceaa4><dl class="nav-dropdown-subitem-wrapper" data-v-8afceaa4><dt data-v-8afceaa4>接口规范</dt><!--[--><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Network/restful/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>RESTful</span><span class="icon" data-v-26978090><!----></span></a></div></dd><dd data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Network/graphql/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>GraphQL</span><span class="icon" data-v-26978090><!----></span></a></div></dd><!--]--></dl></li><!--]--></ul></div></div><div class="item" data-v-0fce24fe><div class="nav-dropdown-link" data-v-0fce24fe data-v-8afceaa4><button class="button" data-v-8afceaa4><span class="button-text" data-v-8afceaa4>服务端</span><span class="right button-arrow" data-v-8afceaa4></span></button><ul class="dialog" data-v-8afceaa4><!--[--><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Server/node/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Node</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Server/connect/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Connect</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Server/express/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Express</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Server/koa/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Koa</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Server/nest/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Nest</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Server/bash/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Bash</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Server/nginx/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Nginx</span><span class="icon" data-v-26978090><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-0fce24fe><div class="nav-dropdown-link" data-v-0fce24fe data-v-8afceaa4><button class="button" data-v-8afceaa4><span class="button-text" data-v-8afceaa4>数据库</span><span class="right button-arrow" data-v-8afceaa4></span></button><ul class="dialog" data-v-8afceaa4><!--[--><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Database/mysql/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>MySQL</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Database/mongodb/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>MongoDB</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Database/redis/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Redis</span><span class="icon" data-v-26978090><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-0fce24fe><div class="nav-dropdown-link" data-v-0fce24fe data-v-8afceaa4><button class="button" data-v-8afceaa4><span class="button-text" data-v-8afceaa4>软件知识</span><span class="right button-arrow" data-v-8afceaa4></span></button><ul class="dialog" data-v-8afceaa4><!--[--><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Software/data-structure/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>数据结构</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Software/algorithm/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>算法</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Software/design-pattern/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>设计模式</span><span class="icon" data-v-26978090><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-0fce24fe><div class="nav-dropdown-link" data-v-0fce24fe data-v-8afceaa4><button class="button" data-v-8afceaa4><span class="button-text" data-v-8afceaa4>工具</span><span class="right button-arrow" data-v-8afceaa4></span></button><ul class="dialog" data-v-8afceaa4><!--[--><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Tools/git/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Git</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Tools/vscode/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Vscode</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Tools/vim/" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Vim</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Tools/window-terminal" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Window Terminal</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Tools/powershell" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>Powershell</span><span class="icon" data-v-26978090><!----></span></a></div></li><li class="dialog-item" data-v-8afceaa4><div class="nav-dropdown-link-item" data-v-8afceaa4 data-v-26978090><a class="item" href="/Tools/node-tree-cli" data-v-26978090><span class="arrow" data-v-26978090></span><span class="text" data-v-26978090>node-tree-cli</span><span class="icon" data-v-26978090><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-0fce24fe><div class="nav-link" data-v-0fce24fe data-v-2cb643ba><a class="item" href="/Books/" data-v-2cb643ba>已阅书籍 <!----></a></div></div><!--]--><!----><div class="item" data-v-0fce24fe><div class="nav-link" data-v-0fce24fe data-v-2cb643ba><a class="item isExternal" href="https://github.com/xutao0793/blog" target="_blank" rel="noopener noreferrer" data-v-2cb643ba>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-2cb643ba><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-79af364c><!--[--><li class="sidebar-link"><p class="sidebar-link-item">源码vue</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-0-index">内容目录</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-1-reactivity-1-detection-chnage">响应式原理1：侦测数据变化</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-1-reactivity-2-collect-dependency">响应式原理2：收集依赖</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-1-reactivity-3-dispatch-update">响应式原理3：源发更新</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-1-reactivity-4-summary">响应式原理4：总结</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-2-compile-0.md">模板编译1：模板内容的几种形式</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-2-compile-1-parse.md">模板编译2：解析器parse</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-2-compile-2-optimize.md">模板编译3：优化器optimize</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-2-compile-3-generate.md">模板编译4：生成器generate</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-3-virtual-dom-1-create-vnode">视图渲染1：virtual dom 和 vnode</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-3-virtual-dom-2-diff">视图渲染2：diff算法</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-4-component-1-extend">组件1：继承extend</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-4-component-2-createComponent">组件2：实例化</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-4-component-3-slot">组件3：插槽slot</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-4-component-4-async">组件4：异步组件</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-4-component-5-keep-alive">组件5：内部组件keep-alive</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-5-initialize-1-constructor">Vue构造函数及实例化</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-5-initialize-2-mergeOptions">选项合并mergeOptions</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-5-initialize-3-options">选项处理options</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-6-extension-1-lifecycle">生命周期lifecycle</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-6-extension-2-event">事件中心event</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-6-extension-3-nextTick">异步任务nextTick</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-6-extension-4-directive">指令directive</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-source-code-6-extension-5-filter">过滤器filter</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">源码vue-router</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-router-source-code-1-install">1安装install</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-router-source-code-2-init">2初始化init</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-router-source-code-3-matcher">3匹配路由matcher</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-router-source-code-4-history">路由对象</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-router-source-code-5-router-link">导航router-link</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vue-router-source-code-6-router-view">视图router-view</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">源码vuex</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vuex-source-code-1-install">1注册</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vuex-source-code-2-instance">2实例化instance</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vuex-source-code-3-api">3接口api</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vuex-source-code-4-register">4路由注册register</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/FE-Framework/vue-technology-source-code/vuex-source-code-5-plugin">5插件实现plugin</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">源码vue-server-render</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item active" href="/FE-Framework/vue-technology-source-code/vue-ssr-source-code">vue-ssr</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#vue-ssr-渲染的几个阶段">Vue SSR 渲染的几个阶段</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#源码解析">源码解析</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#一、webpack-构建结果">一、webpack 构建结果</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#二、初始化-renderer">二、初始化 renderer</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#三、渲染阶段-rendertostring">三、渲染阶段 renderToString</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#四、html-内容输出阶段：">四、HTML 内容输出阶段：</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#五、客户端激活阶段">五、客户端激活阶段</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#参考链接">参考链接</a><!----></li></ul></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-30e7de44><div class="container" data-v-30e7de44><!--[--><!--]--><div style="position:relative;" class="content" data-v-30e7de44><div><h1 id="vue-server-renderer-源码解析" tabindex="-1">vue-server-renderer 源码解析 <a class="header-anchor" href="#vue-server-renderer-源码解析" aria-hidden="true">#</a></h1><h2 id="vue-ssr-渲染的几个阶段" tabindex="-1">Vue SSR 渲染的几个阶段 <a class="header-anchor" href="#vue-ssr-渲染的几个阶段" aria-hidden="true">#</a></h2><ol><li>webpack 编译阶段 <ol><li>入口 entry-client.js 生成用于客户端浏览器渲染的 js 文件和一份用于template组装的json 文件：vue-ssr-server-bundle.json</li><li>服务端打包入口 entry-server.js，生成客户端渲染的 json 文件：vue-ssr-server-bundle.json</li></ol></li><li>初始化 renderer 阶段： <ol><li>使用 vue-server-renderer 的 API 会在node启动时初始化一个renderer 单例对象</li></ol></li><li>渲染阶段： <ol><li>初始化完成，当用户发起请求时，renderer.renderToString 或者 renderer.renderToStream 函数将完成 vue组件到 html 片段的字符串的过程。</li></ol></li><li>HTML 内容输出阶段： <ol><li>渲染阶段我们已经拿到了vue组件渲染结果，它是一个html字符串，在浏览器中展示页面我们还需要css、js 等依赖资源的引入标签 和 通过 store 同步我们在服务端的渲染数据，这些最终组装成一个完整的 html 报文输出到浏览器中。</li></ol></li><li>客户端激活阶段 <ol><li>当客户端发起了请求，服务端返回 HTML，用户就已经可以看到页面渲染结果了，不用等待js加载和执行。但此时页面还不能交互，需要激活客户页面，即 hydirating 过程。</li></ol></li></ol><h2 id="源码解析" tabindex="-1">源码解析 <a class="header-anchor" href="#源码解析" aria-hidden="true">#</a></h2><p>针对上述各个阶段，通过 vue-server-renderer 的源码理清具体逻辑。</p><p>vue-server-renderer 基本完整实现了一个服务端的 vue ，包括模板编译、组件渲染、依赖收集、和状态更新的所有功能。核心代码都跟 vue 差不多，具体可以看 vue 源码相关的文章介绍，这里重点关注 renderer 的创建和回调的执行逻辑。</p><h3 id="一、webpack-构建结果" tabindex="-1">一、webpack 构建结果 <a class="header-anchor" href="#一、webpack-构建结果" aria-hidden="true">#</a></h3><p>当采用<code>VueServerRenderer.createBundleRenderer</code>创建 bundle render 渲染方式时：</p><p>1、通过 <code>entry-client.js / webpack.client.config.js</code> 构建出客户端依赖资源 ：</p><ul><li><p>Client Bundle 包含了所有需要在客户端运行的脚本和静态资源，如：js、css图片、字体等。</p></li><li><p>还有一份 clientManifest 文件清单：vue-ssr-client-manifest.json。</p><ul><li><p>清单中initial数组中的js将会在ssr输出时插入到html字符串中作为preload和script脚本引用。</p></li><li><p>async和modules将配合检索出异步组件和异步依赖库的js文件的引入，在输出阶段我们会详细解读。</p></li></ul></li></ul><div class="language-js"><pre><code><span class="token punctuation">{</span> 
  <span class="token string-property property">&quot;publicPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;//cdn.xxx.cn/xxx/&quot;</span><span class="token punctuation">,</span> 
  <span class="token string-property property">&quot;all&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> 
    <span class="token string">&quot;static/js/app.80f0e94fe005dfb1b2d7.js&quot;</span><span class="token punctuation">,</span> 
    <span class="token string">&quot;static/css/app.d3f8a9a55d0c0be68be0.css&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span> 
  <span class="token string-property property">&quot;initial&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> 
    <span class="token string">&quot;static/js/app.80f0e94fe005dfb1b2d7.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;static/css/app.d3f8a9a55d0c0be68be0.css&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span> 
  <span class="token string-property property">&quot;async&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> 
    <span class="token string">&quot;static/js/xxx.29dba471385af57c280c.js&quot;</span> 
  <span class="token punctuation">]</span><span class="token punctuation">,</span> 
  <span class="token string-property property">&quot;modules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
    <span class="token string-property property">&quot;00f0587d&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">]</span> 
    <span class="token comment">// 省略... </span>
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>2、通过 <code>entry-server.js / webpack.server.config.js</code>构建出的 vue-ssr-server-bundle.json 包含了所有要在服务端运行的代码列表，和一个入口文件名。</p><div class="language-js"><pre><code><span class="token punctuation">{</span> 
  <span class="token string-property property">&quot;entry&quot;</span><span class="token operator">:</span> <span class="token string">&quot;static/js/app.80f0e94fe005dfb1b2d7.js&quot;</span><span class="token punctuation">,</span> 
  <span class="token string-property property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
    <span class="token string-property property">&quot;app.80f0e94fe005dfb1b2d7.js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module.exports=function(t...&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 所有服务端运行的代码</span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre></div><h2 id="二、初始化-renderer" tabindex="-1">二、初始化 renderer <a class="header-anchor" href="#二、初始化-renderer" aria-hidden="true">#</a></h2><p>vue-server-renderer 提供了两种方式创建 renderer：<code>createRenderer / createBundleRenderer</code></p><div class="language-js"><pre><code><span class="token comment">// 第一种：简单的适合演示学习</span>
<span class="token keyword">const</span> vueServerRenderer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;vue-server-renderer&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> template <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">&#39;./index.template.html&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> renderer <span class="token operator">=</span> vueServerRenderer<span class="token punctuation">.</span><span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> template
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 第二种：适合实际工程，需要配合构建工具和构建插件</span>
<span class="token keyword">const</span> VueServerRenderer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;vue-server-renderer&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> template <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">&#39;./index.template.html&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> serverBundle <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./dist/server/vue-ssr-server-bundle.json&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> clientManifest <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./dist/client/vue-ssr-client-manifest.json&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> renderer <span class="token operator">=</span> VueServerRenderer<span class="token punctuation">.</span><span class="token function">createBundleRenderer</span><span class="token punctuation">(</span>serverBundle<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">runInNewContext</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  template<span class="token punctuation">,</span>
  clientManifest
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>源码入口</p><div class="language-js"><pre><code><span class="token comment">// const VueServerRenderer = require(&#39;vue-server-renderer&#39;) 所获得的对象</span>
<span class="token keyword">function</span> <span class="token function">createRenderer$1</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> options <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span> <span class="token punctuation">)</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">isUnaryTag</span><span class="token operator">:</span> isUnaryTag<span class="token punctuation">,</span>
    <span class="token literal-property property">canBeLeftOpenTag</span><span class="token operator">:</span> canBeLeftOpenTag<span class="token punctuation">,</span>
    <span class="token literal-property property">modules</span><span class="token operator">:</span> modules<span class="token punctuation">,</span>
    <span class="token literal-property property">directives</span><span class="token operator">:</span> <span class="token function">extend</span><span class="token punctuation">(</span>baseDirectives<span class="token punctuation">,</span> options<span class="token punctuation">.</span>directives<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> createBundleRenderer <span class="token operator">=</span> <span class="token function">createBundleRendererCreator</span><span class="token punctuation">(</span>createRenderer$1<span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span>createRenderer <span class="token operator">=</span> createRenderer$1<span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>createBundleRenderer <span class="token operator">=</span> createBundleRenderer<span class="token punctuation">;</span>
</code></pre></div><p>看下 从<code>createRenderer</code>到<code>createBundleRenderer</code> 的差异逻辑的关键函数<code>createBundleRendererCreator</code></p><div class="language-js"><pre><code>
<span class="token keyword">function</span> <span class="token function">createBundleRendererCreator</span> <span class="token punctuation">(</span><span class="token parameter">createRenderer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">createBundleRenderer</span> <span class="token punctuation">(</span> <span class="token parameter">bundle<span class="token punctuation">,</span>  rendererOptions</span>  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> rendererOptions <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span> <span class="token punctuation">)</span> rendererOptions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> files<span class="token punctuation">,</span> entry<span class="token punctuation">,</span> maps<span class="token punctuation">;</span>
    <span class="token keyword">var</span> basedir <span class="token operator">=</span> rendererOptions<span class="token punctuation">.</span>basedir<span class="token punctuation">;</span>

    <span class="token comment">// load bundle if given filepath</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      <span class="token keyword">typeof</span> bundle <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span> <span class="token operator">&amp;&amp;</span>
      <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js(on)?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
      path$2<span class="token punctuation">.</span><span class="token function">isAbsolute</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span> <span class="token comment">// var path$2 = require(&#39;path&#39;);</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> isJSON <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.json$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        basedir <span class="token operator">=</span> basedir <span class="token operator">||</span> path$2<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bundle <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>bundle<span class="token punctuation">,</span> <span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isJSON<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            bundle <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid JSON bundle file: &quot;</span> <span class="token operator">+</span> bundle<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot locate bundle file: &quot;</span> <span class="token operator">+</span> bundle<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * server bundle
     * { 
     *    &quot;entry&quot;: &quot;static/js/app.80f0e94fe005dfb1b2d7.js&quot;, 
     *    &quot;files&quot;: { 
     *       &quot;app.80f0e94fe005dfb1b2d7.js&quot;: &quot;module.exports=function(t...&quot;, // 所有服务端运行的代码
     *  } 
     */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> bundle <span class="token operator">===</span> <span class="token string">&#39;object&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      entry <span class="token operator">=</span> bundle<span class="token punctuation">.</span>entry<span class="token punctuation">;</span>
      files <span class="token operator">=</span> bundle<span class="token punctuation">.</span>files<span class="token punctuation">;</span>

      basedir <span class="token operator">=</span> basedir <span class="token operator">||</span> bundle<span class="token punctuation">.</span>basedir<span class="token punctuation">;</span>
      maps <span class="token operator">=</span> <span class="token function">createSourceMapConsumers</span><span class="token punctuation">(</span>bundle<span class="token punctuation">.</span>maps<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> entry <span class="token operator">!==</span> <span class="token string">&#39;string&#39;</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> files <span class="token operator">!==</span> <span class="token string">&#39;object&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token constant">INVALID_MSG</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> bundle <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      entry <span class="token operator">=</span> <span class="token string">&#39;__vue_ssr_bundle__&#39;</span><span class="token punctuation">;</span>
      files <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string-property property">&#39;__vue_ssr_bundle__&#39;</span><span class="token operator">:</span> bundle <span class="token punctuation">}</span><span class="token punctuation">;</span>
      maps <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token constant">INVALID_MSG</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> renderer <span class="token operator">=</span> <span class="token function">createRenderer</span><span class="token punctuation">(</span>rendererOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 这里创建的 run 就代替了我们在 server.js 手动执行 createApp(context) 代码的关键。
     */</span>
    <span class="token keyword">var</span> run <span class="token operator">=</span> <span class="token function">createBundleRunner</span><span class="token punctuation">(</span>
      entry<span class="token punctuation">,</span>
      files<span class="token punctuation">,</span>
      basedir<span class="token punctuation">,</span>
      rendererOptions<span class="token punctuation">.</span>runInNewContext
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">renderToString</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 省略到 渲染阶段分析</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token function-variable function">renderToStream</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 省略到 渲染阶段分析</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到，<code>createBundleRendererCreator</code>函数的关键是创建一个 run 函数和 renderer 函数。其中 run 执行函数就是为什么使用 bundle render 渲染方式时不需要我们手动在 server.js 中执行 createApp 的原因。</p><p>之后就是共同的核心代码 createRender 函数</p><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">createRenderer</span> <span class="token punctuation">(</span><span class="token parameter">ref</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> ref <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span> <span class="token punctuation">)</span> ref <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> modules <span class="token operator">=</span> ref<span class="token punctuation">.</span>modules<span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> modules <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span> <span class="token punctuation">)</span> modules <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> directives <span class="token operator">=</span> ref<span class="token punctuation">.</span>directives<span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> directives <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span> <span class="token punctuation">)</span> directives <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> isUnaryTag <span class="token operator">=</span> ref<span class="token punctuation">.</span>isUnaryTag<span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> isUnaryTag <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span> <span class="token punctuation">)</span> isUnaryTag <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> template <span class="token operator">=</span> ref<span class="token punctuation">.</span>template<span class="token punctuation">;</span>
  <span class="token keyword">var</span> inject <span class="token operator">=</span> ref<span class="token punctuation">.</span>inject<span class="token punctuation">;</span>
  <span class="token keyword">var</span> cache <span class="token operator">=</span> ref<span class="token punctuation">.</span>cache<span class="token punctuation">;</span>
  <span class="token keyword">var</span> shouldPreload <span class="token operator">=</span> ref<span class="token punctuation">.</span>shouldPreload<span class="token punctuation">;</span>
  <span class="token keyword">var</span> shouldPrefetch <span class="token operator">=</span> ref<span class="token punctuation">.</span>shouldPrefetch<span class="token punctuation">;</span>
  <span class="token keyword">var</span> clientManifest <span class="token operator">=</span> ref<span class="token punctuation">.</span>clientManifest<span class="token punctuation">;</span>
  <span class="token keyword">var</span> serializer <span class="token operator">=</span> ref<span class="token punctuation">.</span>serializer<span class="token punctuation">;</span>

  <span class="token keyword">var</span> render <span class="token operator">=</span> <span class="token function">createRenderFunction</span><span class="token punctuation">(</span>modules<span class="token punctuation">,</span> directives<span class="token punctuation">,</span> isUnaryTag<span class="token punctuation">,</span> cache<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> templateRenderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> template<span class="token punctuation">,</span>
    <span class="token literal-property property">inject</span><span class="token operator">:</span> inject<span class="token punctuation">,</span>
    <span class="token literal-property property">shouldPreload</span><span class="token operator">:</span> shouldPreload<span class="token punctuation">,</span>
    <span class="token literal-property property">shouldPrefetch</span><span class="token operator">:</span> shouldPrefetch<span class="token punctuation">,</span>
    <span class="token literal-property property">clientManifest</span><span class="token operator">:</span> clientManifest<span class="token punctuation">,</span>
    <span class="token literal-property property">serializer</span><span class="token operator">:</span> serializer
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">renderToString</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">renderToString</span> <span class="token punctuation">(</span><span class="token parameter">component<span class="token punctuation">,</span> context<span class="token punctuation">,</span> cb</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 省略到 渲染阶段分析</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function-variable function">renderToStream</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">renderToStream</span> <span class="token punctuation">(</span><span class="token parameter">component<span class="token punctuation">,</span> context</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 省略到 渲染阶段分析</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到 createRenderer 函数的核心是创建了 render 和 templateRenderer 两个函数。</p><ul><li>render 用于渲染 vue 组件成 html 片段的字符串结果</li><li>templateRenderer 用于根据我们传入的 template 来组装最终需要返回的 html 结果，用于浏览器渲染。</li></ul><h2 id="三、渲染阶段-rendertostring" tabindex="-1">三、渲染阶段 renderToString <a class="header-anchor" href="#三、渲染阶段-rendertostring" aria-hidden="true">#</a></h2><p>初始化完成，当用户发起请求时，renderer.renderToString 或者 renderer.renderToStream 函数将完成 vue组件到 html 片段的字符串的过程。</p><div class="language-js"><pre><code>server<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;*&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 使用 createBundleRenderer 创建的 renderer 中会在内部添加 context.state / context.rendered </span>
  <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">url</span><span class="token operator">:</span> req<span class="token punctuation">.</span>url<span class="token punctuation">}</span>
  renderer<span class="token punctuation">.</span><span class="token function">renderToString</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">html</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&#39;Content-Type&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;text/html&#39;</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;Internal Server&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>所以我们看下 <code>renderToString</code> 的实现：</p><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">renderToString</span> <span class="token punctuation">(</span><span class="token parameter">component<span class="token punctuation">,</span> context<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> assign<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> context <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cb <span class="token operator">=</span> context<span class="token punctuation">;</span>
    context <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    templateRenderer<span class="token punctuation">.</span><span class="token function">bindRenderFns</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// no callback, return Promise</span>
  <span class="token keyword">var</span> promise<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    assign <span class="token operator">=</span> <span class="token function">createPromiseCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    promise <span class="token operator">=</span> assign<span class="token punctuation">.</span>promise
    cb <span class="token operator">=</span> assign<span class="token punctuation">.</span>cb
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> write <span class="token operator">=</span> <span class="token function">createWriteFunction</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result <span class="token operator">+=</span> text<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">//渲染阶段： renderer 用来渲染 vue 组件成 marker；</span>
    <span class="token function">render</span><span class="token punctuation">(</span>component<span class="token punctuation">,</span> write<span class="token punctuation">,</span> context<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token operator">&amp;&amp;</span> context<span class="token punctuation">.</span>rendered<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// vue 组件渲染完成回调时机</span>
        context<span class="token punctuation">.</span><span class="token function">rendered</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token comment">// 在渲染阶段的回调中，组装输出 HTL：templateRenderer 用来处理组装模板文件成最终输出的 html，此时就会使用 clientManifest</span>
          <span class="token keyword">var</span> res <span class="token operator">=</span> templateRenderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> res <span class="token operator">!==</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// function template returning promise</span>
            res<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> html<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">cb</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">cb</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> promise
<span class="token punctuation">}</span>
</code></pre></div><p>其中回调的大部分代码都是为了兼容 <code>fn(err.html) / promise.then(html)</code>，关键逻辑就是调用 <code>createRender</code>函数生成的 <code>render / templateRender</code>方法。并且 templateRnder 是在 render 完成后的回调中执行。</p><p>所以我们先来关注创建 <code>render</code> 的 <code>createRenderFunction</code>的实现：</p><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">createRenderFunction</span> <span class="token punctuation">(</span> <span class="token parameter">modules<span class="token punctuation">,</span> directives<span class="token punctuation">,</span> isUnaryTag<span class="token punctuation">,</span> cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">render</span> <span class="token punctuation">(</span> <span class="token parameter">component<span class="token punctuation">,</span> write<span class="token punctuation">,</span> userContext<span class="token punctuation">,</span> done</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    warned <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 1. 生成渲染上下文</span>
    <span class="token keyword">var</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RenderContext</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">activeInstance</span><span class="token operator">:</span> component<span class="token punctuation">,</span>
      <span class="token literal-property property">userContext</span><span class="token operator">:</span> userContext<span class="token punctuation">,</span>
      <span class="token literal-property property">write</span><span class="token operator">:</span> write<span class="token punctuation">,</span> 
      <span class="token literal-property property">done</span><span class="token operator">:</span> done<span class="token punctuation">,</span> 
      <span class="token literal-property property">renderNode</span><span class="token operator">:</span> renderNode<span class="token punctuation">,</span>
      <span class="token literal-property property">modules</span><span class="token operator">:</span> modules<span class="token punctuation">,</span> 
      <span class="token literal-property property">isUnaryTag</span><span class="token operator">:</span> isUnaryTag<span class="token punctuation">,</span> 
      <span class="token literal-property property">directives</span><span class="token operator">:</span> directives<span class="token punctuation">,</span>
      <span class="token literal-property property">cache</span><span class="token operator">:</span> cache
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2. 安装服务端渲染的工具函数</span>
    <span class="token function">installSSRHelpers</span><span class="token punctuation">(</span>component<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//3. 编译组件生成 $options.render 属性，即生成 compiled 编译模板，生成$options.render 和 $options.staticRenderFns，同 Vue 源码编译阶段一样 </span>
    <span class="token function">normalizeRender</span><span class="token punctuation">(</span>component<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      <span class="token comment">// 5. 渲染组件，比较下 vue 源码： vm._update(vm._render(), hydrating), 差异就是 _update 过程，即 patch 过程</span>
      <span class="token comment">// Vue.prototype._render 关键代码就是执行编译生成的渲染函数，即 $options.render：</span>
      <span class="token comment">// vnode = component.$options.render.call(vm, vm.$createElement);</span>
      <span class="token function">renderNode</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 4. 等待组件 serverPrefetch 执行，获取组件依赖的数据</span>
    <span class="token function">waitForServerPrefetch</span><span class="token punctuation">(</span>component<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> done<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>深入到上面每一步函数的代码：</p><div class="language-js"><pre><code><span class="token comment">/**
 * 1. 生成渲染上下文
 */</span>
<span class="token keyword">var</span> <span class="token function-variable function">RenderContext</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">RenderContext</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>userContext <span class="token operator">=</span> options<span class="token punctuation">.</span>userContext<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>activeInstance <span class="token operator">=</span> options<span class="token punctuation">.</span>activeInstance<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>renderStates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>write <span class="token operator">=</span> options<span class="token punctuation">.</span>write<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>done <span class="token operator">=</span> options<span class="token punctuation">.</span>done<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>renderNode <span class="token operator">=</span> options<span class="token punctuation">.</span>renderNode<span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>isUnaryTag <span class="token operator">=</span> options<span class="token punctuation">.</span>isUnaryTag<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>modules <span class="token operator">=</span> options<span class="token punctuation">.</span>modules<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>directives <span class="token operator">=</span> options<span class="token punctuation">.</span>directives<span class="token punctuation">;</span>

  <span class="token keyword">var</span> cache <span class="token operator">=</span> options<span class="token punctuation">.</span>cache<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cache <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>cache<span class="token punctuation">.</span>get <span class="token operator">||</span> <span class="token operator">!</span>cache<span class="token punctuation">.</span>set<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;renderer cache must implement at least get &amp; set.&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cache <span class="token operator">=</span> cache<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>get <span class="token operator">=</span> cache <span class="token operator">&amp;&amp;</span> <span class="token function">normalizeAsync</span><span class="token punctuation">(</span>cache<span class="token punctuation">,</span> <span class="token string">&#39;get&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>has <span class="token operator">=</span> cache <span class="token operator">&amp;&amp;</span> <span class="token function">normalizeAsync</span><span class="token punctuation">(</span>cache<span class="token punctuation">,</span> <span class="token string">&#39;has&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">RenderContext</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">next</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">next</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// eslint-disable-next-line</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> lastState <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>renderStates<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>renderStates<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>lastState<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* eslint-disable no-case-declarations */</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>lastState<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&#39;Element&#39;</span><span class="token operator">:</span>
      <span class="token keyword">case</span> <span class="token string">&#39;Fragment&#39;</span><span class="token operator">:</span>
        <span class="token keyword">var</span> children <span class="token operator">=</span> lastState<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
      <span class="token keyword">var</span> total <span class="token operator">=</span> lastState<span class="token punctuation">.</span>total<span class="token punctuation">;</span>
        <span class="token keyword">var</span> rendered <span class="token operator">=</span> lastState<span class="token punctuation">.</span>rendered<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rendered <span class="token operator">&lt;</span> total<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderNode</span><span class="token punctuation">(</span>children<span class="token punctuation">[</span>rendered<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>renderStates<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>lastState<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&#39;Element&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>lastState<span class="token punctuation">.</span>endTag<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>next<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">break</span>
      <span class="token keyword">case</span> <span class="token string">&#39;Component&#39;</span><span class="token operator">:</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderStates<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>activeInstance <span class="token operator">=</span> lastState<span class="token punctuation">.</span>prevActive<span class="token punctuation">;</span>
        <span class="token keyword">break</span>
      <span class="token keyword">case</span> <span class="token string">&#39;ComponentWithCache&#39;</span><span class="token operator">:</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderStates<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> buffer <span class="token operator">=</span> lastState<span class="token punctuation">.</span>buffer<span class="token punctuation">;</span>
        <span class="token keyword">var</span> bufferIndex <span class="token operator">=</span> lastState<span class="token punctuation">.</span>bufferIndex<span class="token punctuation">;</span>
        <span class="token keyword">var</span> componentBuffer <span class="token operator">=</span> lastState<span class="token punctuation">.</span>componentBuffer<span class="token punctuation">;</span>
        <span class="token keyword">var</span> key <span class="token operator">=</span> lastState<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
        <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">html</span><span class="token operator">:</span> buffer<span class="token punctuation">[</span>bufferIndex<span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token literal-property property">components</span><span class="token operator">:</span> componentBuffer<span class="token punctuation">[</span>bufferIndex<span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bufferIndex <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// this is a top-level cached component,</span>
          <span class="token comment">// exit caching mode.</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>write<span class="token punctuation">.</span>caching <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// parent component is also being cached,</span>
          <span class="token comment">// merge self into parent&#39;s result</span>
          buffer<span class="token punctuation">[</span>bufferIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> result<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
          <span class="token keyword">var</span> prev <span class="token operator">=</span> componentBuffer<span class="token punctuation">[</span>bufferIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          result<span class="token punctuation">.</span>components<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> prev<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        buffer<span class="token punctuation">.</span>length <span class="token operator">=</span> bufferIndex<span class="token punctuation">;</span>
        componentBuffer<span class="token punctuation">.</span>length <span class="token operator">=</span> bufferIndex<span class="token punctuation">;</span>
        <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 2. 安装服务端渲染的工具函数
 */</span>
<span class="token keyword">var</span> ssrHelpers <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">_ssrEscape</span><span class="token operator">:</span> escape<span class="token punctuation">,</span>
  <span class="token literal-property property">_ssrNode</span><span class="token operator">:</span> renderStringNode<span class="token punctuation">,</span>
  <span class="token literal-property property">_ssrList</span><span class="token operator">:</span> renderStringList<span class="token punctuation">,</span>
  <span class="token literal-property property">_ssrAttr</span><span class="token operator">:</span> renderAttr<span class="token punctuation">,</span>
  <span class="token literal-property property">_ssrAttrs</span><span class="token operator">:</span> renderAttrs$1<span class="token punctuation">,</span>
  <span class="token literal-property property">_ssrDOMProps</span><span class="token operator">:</span> renderDOMProps$1<span class="token punctuation">,</span>
  <span class="token literal-property property">_ssrClass</span><span class="token operator">:</span> renderSSRClass<span class="token punctuation">,</span>
  <span class="token literal-property property">_ssrStyle</span><span class="token operator">:</span> renderSSRStyle
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">installSSRHelpers</span> <span class="token punctuation">(</span><span class="token parameter">vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_ssrNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> Vue <span class="token operator">=</span> vm<span class="token punctuation">.</span>constructor<span class="token punctuation">;</span>
  <span class="token comment">// 向上找到根的 vue 构造函数</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>Vue<span class="token punctuation">.</span>super<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Vue <span class="token operator">=</span> Vue<span class="token punctuation">.</span>super<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">extend</span><span class="token punctuation">(</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> ssrHelpers<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Vue<span class="token punctuation">.</span>FunctionalRenderContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">extend</span><span class="token punctuation">(</span>Vue<span class="token punctuation">.</span><span class="token class-name">FunctionalRenderContext</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> ssrHelpers<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 3. 编译组件生成 $options.render 属性，即生成 compiled 编译模板，生成$options.render 和 $options.staticRenderFns，
 * 同 Vue 源码编译阶段一样 
 */</span>
<span class="token keyword">var</span> <span class="token function-variable function">normalizeRender</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> ref <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">;</span>
  <span class="token keyword">var</span> render <span class="token operator">=</span> ref<span class="token punctuation">.</span>render<span class="token punctuation">;</span>
  <span class="token keyword">var</span> template <span class="token operator">=</span> ref<span class="token punctuation">.</span>template<span class="token punctuation">;</span>
  <span class="token keyword">var</span> _scopeId <span class="token operator">=</span> ref<span class="token punctuation">.</span>_scopeId<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> compiled <span class="token operator">=</span> <span class="token function">compileToFunctions</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">scopeId</span><span class="token operator">:</span> _scopeId<span class="token punctuation">,</span>
        <span class="token literal-property property">warn</span><span class="token operator">:</span> onCompilationError
      <span class="token punctuation">}</span><span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">;</span>

      vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>render <span class="token operator">=</span> compiled<span class="token punctuation">.</span>render<span class="token punctuation">;</span>
      vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>staticRenderFns <span class="token operator">=</span> compiled<span class="token punctuation">.</span>staticRenderFns<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token string">&quot;render function or template not defined in component: &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>name <span class="token operator">||</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_componentTag <span class="token operator">||</span> <span class="token string">&#39;anonymous&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 4. 等待组件 serverPrefetch 执行，获取组件依赖的数据
 */</span>
<span class="token keyword">function</span> <span class="token function">waitForServerPrefetch</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> handlers <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>serverPrefetch<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>handlers<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>handlers<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> handlers <span class="token operator">=</span> <span class="token punctuation">[</span>handlers<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> handlers<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> j<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> result <span class="token operator">=</span> handlers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> result<span class="token punctuation">.</span>then <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          promises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 5. 渲染组件，比较下 vue 源码： vm._update(vm._render(), hydrating), 差异就是 _update 过程，即 patch 过程
 */</span>
<span class="token keyword">function</span> <span class="token function">renderNode</span> <span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> isRoot<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * 根据节点的类型，使用不同方式处理
   */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>isString<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">renderStringNode$1</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>componentOptions<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">renderComponent</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> isRoot<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">renderElement</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> isRoot<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>isComment<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>asyncFactory<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// async component</span>
      <span class="token function">renderAsyncComponent</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> isRoot<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;!--&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;--&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>
      node<span class="token punctuation">.</span>raw <span class="token operator">?</span> node<span class="token punctuation">.</span>text <span class="token operator">:</span> <span class="token function">escape</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      context<span class="token punctuation">.</span>next
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>renderNode 的结果就是调用传入的 <code>write</code>方法拼接出返回的 HTML 片段字符串。</p><p>看下传入的 <code>context.write</code>的实现，关键就是：<code> reslut += text</code> 字段串的拼接。</p><div class="language-js"><pre><code><span class="token keyword">var</span> write <span class="token operator">=</span> <span class="token function">createWriteFunction</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result <span class="token operator">+=</span> text<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="四、html-内容输出阶段：" tabindex="-1">四、HTML 内容输出阶段： <a class="header-anchor" href="#四、html-内容输出阶段：" aria-hidden="true">#</a></h2><p>渲染阶段我们已经拿到了vue组件渲染结果，它是一个html 片段字符串，在浏览器中展示页面我们还需要css、js 等依赖资源的引入标签 和 通过 store 同步我们在服务端的渲染数据，这些最终组装成一个完整的 html 报文输出到浏览器中。</p><p>这些的实现就是 templateRender 函数，关键是我们传入的模板文件 <code>template</code> 和构建出来的 <code>clientManifest</code></p><div class="language-js"><pre><code><span class="token keyword">var</span> templateRenderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> template<span class="token punctuation">,</span>
    <span class="token literal-property property">inject</span><span class="token operator">:</span> inject<span class="token punctuation">,</span>
    <span class="token literal-property property">shouldPreload</span><span class="token operator">:</span> shouldPreload<span class="token punctuation">,</span>
    <span class="token literal-property property">shouldPrefetch</span><span class="token operator">:</span> shouldPrefetch<span class="token punctuation">,</span>
    <span class="token literal-property property">clientManifest</span><span class="token operator">:</span> clientManifest<span class="token punctuation">,</span>
    <span class="token literal-property property">serializer</span><span class="token operator">:</span> serializer
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>看下 <code>TemplateRenderer</code> 构建类的实现</p><div class="language-js"><pre><code><span class="token keyword">var</span> <span class="token function-variable function">TemplateRenderer</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">TemplateRenderer</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>inject <span class="token operator">=</span> options<span class="token punctuation">.</span>inject <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 第一步：解析传入的模板文件 template  </span>
  <span class="token keyword">var</span> template <span class="token operator">=</span> options<span class="token punctuation">.</span>template<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>parsedTemplate <span class="token operator">=</span> template
    <span class="token operator">?</span> <span class="token keyword">typeof</span> template <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span>
      <span class="token operator">?</span> <span class="token function">parseTemplate</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span>
      <span class="token operator">:</span> template
    <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token comment">// function used to serialize initial state JSON</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>serialize <span class="token operator">=</span> options<span class="token punctuation">.</span>serializer <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">serialize</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">isJSON</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 第二步：解析传入的 clientManifest</span>
  <span class="token comment">// extra functionality with client manifest</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>clientManifest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> clientManifest <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>clientManifest <span class="token operator">=</span> options<span class="token punctuation">.</span>clientManifest<span class="token punctuation">;</span>
    <span class="token comment">// ensure publicPath ends with /</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>publicPath <span class="token operator">=</span> clientManifest<span class="token punctuation">.</span>publicPath <span class="token operator">===</span> <span class="token string">&#39;&#39;</span>
      <span class="token operator">?</span> <span class="token string">&#39;&#39;</span>
      <span class="token operator">:</span> clientManifest<span class="token punctuation">.</span>publicPath<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">([^\/])$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&#39;$1/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// preload/prefetch directives</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>preloadFiles <span class="token operator">=</span> <span class="token punctuation">(</span>clientManifest<span class="token punctuation">.</span>initial <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>normalizeFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>prefetchFiles <span class="token operator">=</span> <span class="token punctuation">(</span>clientManifest<span class="token punctuation">.</span>async <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>normalizeFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// initial async chunk mapping</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mapFiles <span class="token operator">=</span> <span class="token function">createMapper</span><span class="token punctuation">(</span>clientManifest<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>先看下对模板的解析函数处理逻辑：</p><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">parseTemplate</span> <span class="token punctuation">(</span>
  <span class="token parameter">template<span class="token punctuation">,</span>
  contentPlaceholder</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> contentPlaceholder <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span> <span class="token punctuation">)</span> contentPlaceholder <span class="token operator">=</span> <span class="token string">&#39;&lt;!--vue-ssr-outlet--&gt;&#39;</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> template <span class="token operator">===</span> <span class="token string">&#39;object&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> template
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> i <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;&lt;/head&gt;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> j <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>contentPlaceholder<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Content placeholder not found in template.&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    i <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;&lt;body&gt;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      i <span class="token operator">=</span> j<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">head</span><span class="token operator">:</span> <span class="token function">compile$1</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> compileOptions<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">neck</span><span class="token operator">:</span> <span class="token function">compile$1</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> compileOptions<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">tail</span><span class="token operator">:</span> <span class="token function">compile$1</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>j <span class="token operator">+</span> contentPlaceholder<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">,</span> compileOptions<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里我们看到熟悉的服务端渲染的标记<code>&lt;!--vue-ssr-outlet--&gt;</code>，以此为基础，将模板文件分为 <code>head / neck / tail</code>三部分返回。</p><p>在 render 回调函数中，最终返回 HTML 的函数是调用 <code>var res = templateRenderer.render(result, context);</code>所以，我们看下 <code>TemplateRenderer.prototype.render</code>的定义：</p><div class="language-js"><pre><code><span class="token class-name">TemplateRenderer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">render</span> <span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> template <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parsedTemplate<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;render cannot be called without a template.&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  context <span class="token operator">=</span> context <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> template <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">template</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>inject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      template<span class="token punctuation">.</span><span class="token function">head</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">+</span>
      <span class="token punctuation">(</span>context<span class="token punctuation">.</span>head <span class="token operator">||</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token operator">+</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderResourceHints</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">+</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderStyles</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">+</span>
      template<span class="token punctuation">.</span><span class="token function">neck</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">+</span>
      content <span class="token operator">+</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderState</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">+</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderScripts</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">+</span>
      template<span class="token punctuation">.</span><span class="token function">tail</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      template<span class="token punctuation">.</span><span class="token function">head</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">+</span>
      template<span class="token punctuation">.</span><span class="token function">neck</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">+</span>
      content <span class="token operator">+</span>
      template<span class="token punctuation">.</span><span class="token function">tail</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><p>看到这里就明白，最终是将 render 函数渲染的结果 content 与 head / neck / tail 完成拼装。关于每部分具体的工具函数 <code>renderResourceHints / renderStyles /renderState / renderScripts </code> 可以自行查看源码。</p><p>这里我们关注下实现同步应用数据状态同步 store.state 的实现 <code>renderState</code></p><div class="language-js"><pre><code><span class="token class-name">TemplateRenderer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">renderState</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">renderState</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> ref <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> contextKey <span class="token operator">=</span> ref<span class="token punctuation">.</span>contextKey<span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> contextKey <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span> <span class="token punctuation">)</span> contextKey <span class="token operator">=</span> <span class="token string">&#39;state&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> windowKey <span class="token operator">=</span> ref<span class="token punctuation">.</span>windowKey<span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> windowKey <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span> <span class="token punctuation">)</span> windowKey <span class="token operator">=</span> <span class="token string">&#39;__INITIAL_STATE__&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> state <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span>context<span class="token punctuation">[</span>contextKey<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> autoRemove <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> nonceAttr <span class="token operator">=</span> context<span class="token punctuation">.</span>nonce <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token string">&quot; nonce=\&quot;&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>nonce<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\&quot;&quot;</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> context<span class="token punctuation">[</span>contextKey<span class="token punctuation">]</span>
    <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token string">&quot;&lt;script&quot;</span> <span class="token operator">+</span> nonceAttr <span class="token operator">+</span> <span class="token string">&quot;&gt;window.&quot;</span> <span class="token operator">+</span> windowKey <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> state <span class="token operator">+</span> autoRemove <span class="token operator">+</span> <span class="token string">&quot;&lt;/script&gt;&quot;</span><span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token string">&#39;&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="五、客户端激活阶段" tabindex="-1">五、客户端激活阶段 <a class="header-anchor" href="#五、客户端激活阶段" aria-hidden="true">#</a></h2><p>当客户端发起了请求，服务端返回 HTML，用户就已经可以看到页面渲染结果了，不用等待js加载和执行。</p><p>但此时页面还不能交互，需要激活客户页面，即 hydirating 过程。 这里就涉及 Vue 的源码部分。</p><blockquote><p>先来解释一下 hydration，这个概念和同构应用中数据的获取和消费有关。在服务器端渲染时，需要在服务端请求接口预取数据，处理并准备好数据状态（如果用 vuex，就进行 store 更新）。为了避免客户端重复请求这部分已经预取的数据，我们需要保留住这个状态，一般的做法是在服务器端返回 HTML 字符串的时候，将数据一并返回，这个过程称为<strong>脱水（dehydrate）</strong>。<code>&lt;script&gt;window.____INITIAL_STATE__ = context.state;&lt;/script&gt;</code>；<br>在客户端渲染时，就不再需要进行这部分数据状态的请求，可以直接使用服务器下发的数据，这个过程叫做<strong>注水（hydrate）</strong>。<code>if (window.__INITIAL_STATE__) {store.replaceState(window.__INITIAL_STATE__)}</code></p></blockquote><div class="language-js"><pre><code><span class="token comment">/**
 * Vue 渲染流程
 * 1. HTML 模板，只有 &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;
 * 2. 加载 js，在 js 中执行 new Vue 里的一系列初始化代码
 * 3. 挂载：vm.$mount(&#39;#app&#39;)
 *    3.1 cmopile: 编译模板成渲染函数赋值给 vm.$option.render，即 with(this) {...}
 *    3.2 render: vm._render 执行 vm.$option.render 渲染生成 Vnode，依赖收集也在这步进行
 *    3.3 update：vm._update ：属性事件等数据更新，及挂载DOM
 *        3.3.1 执行旧 oldVnode 和新 Vnode 对比 patch / patchVnode，完成属性等数据到真实 DOM中；主要由 invokeCreateHooks 函数完成
 *        下面这步就是 SSR 的分界点：
 *        3.3.2 如果是服务端渲染：不执行挂载，直接退出。因为此时已经将相关节点的属性、事件等数据同步到 DOM 中。
 * 
 * 所以 SSR 操作中，同一份 HTML 片段同时在服务器和客户端被初始化、编译、到一半的 _update 过程，所以 SSR 也称为同构。
 */</span>

<span class="token comment">// virtual DOM patching 算法主要逻辑</span>
<span class="token keyword">function</span> <span class="token function">createPatchFunction</span> <span class="token punctuation">(</span><span class="token parameter">backend</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 省略代码...</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">patch</span> <span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> hydrating<span class="token punctuation">,</span> removeOnly</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">invokeDestroyHook</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> isInitialPatch <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> insertedVnodeQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// empty mount (likely as component), create new root element</span>
      <span class="token comment">// 如果没有旧节点可对比，说明此时是首次初始化节点，不需要对比，直接用 vnode 创建DOM元素</span>
      isInitialPatch <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> isRealElement <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>nodeType<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRealElement <span class="token operator">&amp;&amp;</span> <span class="token function">sameVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// patch existing root node</span>
        <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> removeOnly<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isRealElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 服务端渲染 SSR 视图更新的主要逻辑：hydrate 函数</span>
          <span class="token comment">//  var SSR_ATTR = &#39;data-server-rendered&#39;;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> oldVnode<span class="token punctuation">.</span><span class="token function">hasAttribute</span><span class="token punctuation">(</span><span class="token constant">SSR_ATTR</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            oldVnode<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token constant">SSR_ATTR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            hydrating <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>hydrating<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/**
             * 由于服务器已经渲染好了 HTML，我们显然无需将其丢弃再重新创建所有的 DOM 元素。
             * 相反，我们需要&quot;激活&quot;这些静态的 HTML，然后使他们成为动态的（能够响应后续的数据变化）。
             * 这步就是 hydrate 过程，最后返回的是服务渲染好的 oldVnode
             */</span>
            <span class="token comment">/**
             * 在开发模式下， hydrate 过程中，Vue 将推断客户端生成的虚拟 DOM 树 (virtual DOM tree)，
             * 是否与从服务器渲染的 DOM 结构 (DOM structure) 匹配。
             * 
             * 在生产模式下，此检测会被跳过，以避免性能损耗。
             */</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hydrate</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">invokeInsertHook</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token comment">// 执行的还是 componentVNodeHooks.insert 插入函数，挂载 insertedVnodeQueue 内子组件 callHook(componentInstance, &#39;mounted&#39;);</span>
              <span class="token keyword">return</span> oldVnode

            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token function">warn</span><span class="token punctuation">(</span>
                <span class="token string">&#39;The client-side rendered virtual DOM tree is not matching &#39;</span> <span class="token operator">+</span>
                <span class="token string">&#39;server-rendered content. This is likely caused by incorrect &#39;</span> <span class="token operator">+</span>
                <span class="token string">&#39;HTML markup, for example nesting block-level elements inside &#39;</span> <span class="token operator">+</span>
                <span class="token string">&#39;&lt;p&gt;, or missing &lt;tbody&gt;. Bailing hydration and performing &#39;</span> <span class="token operator">+</span>
                <span class="token string">&#39;full client-side render.&#39;</span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token comment">/**
           * hydrate 执行返回 False, 无法匹配，它将退出混合模式，丢弃现有的 DOM 并从头开始渲染。
           * 这是下面的代码：将服务器渲染出来拿到真实 Dom 元素 （oldVnode ）置为空节点，
           * 并且继续 if 下面的 createElm 函数，用浏览器端渲染出来的 vnode 创建真实 DOM 元素
           */</span>
          <span class="token comment">// either not server-rendered, or hydration failed.</span>
          <span class="token comment">// create an empty node and replace it</span>
          oldVnode <span class="token operator">=</span> <span class="token function">emptyNodeAt</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// replacing existing element</span>
        <span class="token keyword">var</span> oldElm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm<span class="token punctuation">;</span>
        <span class="token keyword">var</span> parentElm <span class="token operator">=</span> nodeOps<span class="token punctuation">.</span><span class="token function">parentNode</span><span class="token punctuation">(</span>oldElm<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// create new node</span>
        <span class="token comment">// 省略调用 createElm() 函数</span>
<span class="token punctuation">}</span>
</code></pre></div><p>看下vue 源码中 <code>hydrating</code>实现：</p><div class="language-js"><pre><code><span class="token comment">/**
 * hydrating 函数只在由服务端渲染的首屏时使用，主要执行一步操作：
 * 1. 执行旧 oldVnode 和新 Vnode 对比 patch / patchVnode，完成属性等数据到真实 DOM中；这一步在服务端渲染特有的,即 hydrating 激活阶段
 * 而页面 DOM 复用由服务端渲染出来的
 */</span>
<span class="token comment">// Note: this is a browser-only function so we can assume elms are DOM nodes.</span>
<span class="token keyword">function</span> <span class="token function">hydrate</span> <span class="token punctuation">(</span><span class="token parameter">elm<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> inVPre</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> i<span class="token punctuation">;</span>
  <span class="token keyword">var</span> tag <span class="token operator">=</span> vnode<span class="token punctuation">.</span>tag<span class="token punctuation">;</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token keyword">var</span> children <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
  inVPre <span class="token operator">=</span> inVPre <span class="token operator">||</span> <span class="token punctuation">(</span>data <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span>pre<span class="token punctuation">)</span><span class="token punctuation">;</span>
  vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> elm<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>isComment<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>asyncFactory<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vnode<span class="token punctuation">.</span>isAsyncPlaceholder <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// assert node match 断言确定 vnode 是一个组件节点或与node 一样的节点类型</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">assertNodeMatch</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> inVPre<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// componentVNodeHooks.init 主要渲染 vnode 及嵌套的子组件：child.$mount(hydrating ? vnode.elm : undefined, hydrating);</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> data<span class="token punctuation">.</span>hook<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>init<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">i</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* hydrating */</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> vnode<span class="token punctuation">.</span>componentInstance<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// child component. it should have hydrated its own tree.</span>
      <span class="token function">initComponent</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// empty element, allow client to pick up and populate children</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>elm<span class="token punctuation">.</span><span class="token function">hasChildNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">createChildren</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> children<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// v-html and domProps: innerHTML</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>domProps<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">!==</span> elm<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/* istanbul ignore if */</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> console <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span> <span class="token operator">&amp;&amp;</span>
              <span class="token operator">!</span>hydrationBailed
            <span class="token punctuation">)</span> <span class="token punctuation">{</span>
              hydrationBailed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
              console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#39;Parent: &#39;</span><span class="token punctuation">,</span> elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
              console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#39;server innerHTML: &#39;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
              console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#39;client innerHTML: &#39;</span><span class="token punctuation">,</span> elm<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// iterate and compare children lists</span>
          <span class="token keyword">var</span> childrenMatch <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> childNode <span class="token operator">=</span> elm<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i$1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i$1 <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i$1<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>childNode <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">hydrate</span><span class="token punctuation">(</span>childNode<span class="token punctuation">,</span> children<span class="token punctuation">[</span>i$1<span class="token punctuation">]</span><span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> inVPre<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              childrenMatch <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
              <span class="token keyword">break</span>
            <span class="token punctuation">}</span>
            childNode <span class="token operator">=</span> childNode<span class="token punctuation">.</span>nextSibling<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// if childNode is not null, it means the actual childNodes list is</span>
          <span class="token comment">// longer than the virtual children list.</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>childrenMatch <span class="token operator">||</span> childNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/* istanbul ignore if */</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> console <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span> <span class="token operator">&amp;&amp;</span>
              <span class="token operator">!</span>hydrationBailed
            <span class="token punctuation">)</span> <span class="token punctuation">{</span>
              hydrationBailed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
              console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#39;Parent: &#39;</span><span class="token punctuation">,</span> elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
              console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#39;Mismatching childNodes vs. VNodes: &#39;</span><span class="token punctuation">,</span> elm<span class="token punctuation">.</span>childNodes<span class="token punctuation">,</span> children<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> fullInvoke <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isRenderedModule</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          fullInvoke <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token comment">// 组件的属性事件等如何映射到真实的 DOM 元素，就是此函数执行各类钩子函数生效的。</span>
          <span class="token function">invokeCreateHooks</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fullInvoke <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">[</span><span class="token string">&#39;class&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ensure collecting deps for deep class bindings for future updates</span>
        <span class="token function">traverse</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">&#39;class&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>elm<span class="token punctuation">.</span>data <span class="token operator">!==</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    elm<span class="token punctuation">.</span>data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

<span class="token comment">// 调用初始化元素各类属性、事件的钩子</span>
<span class="token keyword">function</span> <span class="token function">invokeCreateHooks</span> <span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> insertedVnodeQueue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i$1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i$1 <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>create<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i$1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cbs<span class="token punctuation">.</span>create<span class="token punctuation">[</span>i$1<span class="token punctuation">]</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  i <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>hook<span class="token punctuation">;</span> <span class="token comment">// Reuse variable</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>create<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> i<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>insert<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> insertedVnodeQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 在把 Vnode 转变成真实的 DOM 期间，有一系列钩子函数来将 Vnode 中的属性、事件等参数转称到真实 DOM 上。
 * var hooks = [&#39;create&#39;, &#39;activate&#39;, &#39;update&#39;, &#39;remove&#39;, &#39;destroy&#39;]
 * 
 * 每个钩子函数，都会执行一系列操作，这些操作分为以下几类：
 * var platformModules = [ attrs, klass, events, domProps, style, transition ];
 * var baseModules = [ ref, directives ];
 * 
 * 每一个种类都定义了它会在哪种hooks中执行哪些逻辑：
 * var attrs = { create: updateAttrs, update: updateAttrs };
 * var klass = { create: updateClass, update: updateClass };
 * var events = { create: updateDOMListeners, update: updateDOMListeners };
 * var domProps = { create: updateDOMProps, update: updateDOMProps };
 * var style = { create: updateStyle, update: updateStyle };
 * var transition = inBrowser ? { 省略代码} : {};
 *   var ref = {省略 create / update / destory 钩子函数代码};
 *   var directives = {省略 create / update / destory 钩子函数代码};
 * 
 *   然后进行转换：从每个操作在哪些钩子执行 到 每个钩子要执行的哪些 update 操作：
 *   var hooks = [&#39;create&#39;, &#39;activate&#39;, &#39;update&#39;, &#39;remove&#39;, &#39;destroy&#39;];
 *   cbs: { create: [updatefn], activate: [updatefn], ...}
 *   modules: platformModules.concat(baseModules)
 *   相当于：[ attrs, klass, events, domProps, style, transition, ref, directive ]
 */</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> hooks<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cbs<span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> modules<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>modules<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cbs<span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>modules<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 在处理一个 vue-component 组件节点时，在执行 createComponent 函数时会安装一系列钩子函数执行
 * var componentVNodeHooks = {init: fn, prepatch: fn, insert: fn, destory:fn}
 * 通过定义对应的执行函数：
 * init =&gt; invokeCreateHooks: 同时执行上面的 cbs.create, 即一系列 updateFn
 * insert =&gt; invokeInsertHooks
 * destory =&gt; invokeDestroyHook: 同时执行上面的 cbs.destory ，即一系列 updateFn
 */</span>
<span class="token keyword">function</span> <span class="token function">installComponentHooks</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> hooks <span class="token operator">=</span> data<span class="token punctuation">.</span>hook <span class="token operator">||</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>hook <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> hooksToMerge<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> key <span class="token operator">=</span> hooksToMerge<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> existing <span class="token operator">=</span> hooks<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> toMerge <span class="token operator">=</span> componentVNodeHooks<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>existing <span class="token operator">!==</span> toMerge <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>existing <span class="token operator">&amp;&amp;</span> existing<span class="token punctuation">.</span>_merged<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      hooks<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> existing <span class="token operator">?</span> <span class="token function">mergeHook$1</span><span class="token punctuation">(</span>toMerge<span class="token punctuation">,</span> existing<span class="token punctuation">)</span> <span class="token operator">:</span> toMerge<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="参考链接" tabindex="-1">参考链接 <a class="header-anchor" href="#参考链接" aria-hidden="true">#</a></h2><p><a href="https://juejin.im/post/6844904001285144589" target="_blank" rel="noopener noreferrer">浅谈Vue SSR中的Bundle</a></p><p><a href="https://zhuanlan.zhihu.com/p/61348429" target="_blank" rel="noopener noreferrer">Vue SSR深度剖析</a></p></div></div><footer class="page-footer" data-v-30e7de44 data-v-504b1bfc><div class="edit" data-v-504b1bfc><div class="edit-link" data-v-504b1bfc data-v-40c300d5><!----></div></div><div class="updated" data-v-504b1bfc><!----></div></footer><div class="next-and-prev-link" data-v-30e7de44 data-v-0f10f042><div class="container" data-v-0f10f042><div class="prev" data-v-0f10f042><a class="link" href="/FE-Framework/vue-technology-source-code/vuex-source-code-5-plugin" data-v-0f10f042><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-0f10f042><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-0f10f042>5插件实现plugin</span></a></div><div class="next" data-v-0f10f042><!----></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"books_index.md\":\"5e8803a3\",\"books_js_bianchengjingcui.md\":\"d7f9a8ef\",\"books_js_ninja_secret.md\":\"4489eead\",\"books_js_object_oriented.md\":\"dc74b467\",\"books_js_qishilv.md\":\"c1053cc8\",\"books_js_xuexizhinan.md\":\"9e3e5621\",\"books_js_yuyanjingcui.md\":\"3ab9b51d\",\"books_js_zhuangjiabiancheng.md\":\"272ae4a4\",\"browser_1-bom_index.md\":\"37f228a1\",\"browser_2-dom_document.md\":\"2314189d\",\"browser_2-dom_dom_event.md\":\"d1a7b5c9\",\"browser_2-dom_element.md\":\"891c54b0\",\"browser_2-dom_node.md\":\"00d92186\",\"browser_2-dom_text.md\":\"d0b4d157\",\"browser_2-dom_index.md\":\"2da7a0e0\",\"browser_3-cssom_index.md\":\"ecbe871a\",\"browser_4-render_architecture.md\":\"921a40d7\",\"browser_4-render_event-loop.md\":\"981599fc\",\"browser_4-render_history.md\":\"14c482cb\",\"browser_4-render_index.md\":\"52ce4f54\",\"browser_4-render_js-execute.md\":\"d3f71757\",\"browser_4-render_render.md\":\"ba7047c9\",\"browser_4-render_stack-heap-gc.md\":\"c01a8b1b\",\"browser_4-render_v8.md\":\"08711725\",\"browser_5-cache_index.md\":\"5999bf59\",\"browser_6-storage_index.md\":\"4251d646\",\"browser_7-security_index.md\":\"4c2a29e1\",\"browser_8-new-api_blob-file-arraybuffer-url.md\":\"2bc6a05c\",\"browser_8-new-api_index.md\":\"cd974712\",\"database_mongodb_index.md\":\"8e753900\",\"database_mysql_index.md\":\"9babfab3\",\"database_redis_index.md\":\"a43ca52b\",\"design_color.md\":\"182276ac\",\"design_figma.md\":\"0e8d54cc\",\"design_font.md\":\"0106c1cd\",\"design_image.md\":\"79a34a19\",\"design_index.md\":\"3138ee3c\",\"fe-engineering_cd-deploy_ftp.md\":\"1da3dc67\",\"fe-engineering_cd-deploy_github-actions.md\":\"fb5c4361\",\"fe-engineering_cd-deploy_index.md\":\"c10127bf\",\"fe-engineering_cd-release_index.md\":\"05ee19fc\",\"fe-engineering_ci-babel_index.md\":\"899e91dc\",\"fe-engineering_ci-gulp_gulp_stream.md\":\"724f6cf8\",\"fe-engineering_ci-gulp_gulp_task.md\":\"7f7edda0\",\"fe-engineering_ci-gulp_gulp_vinyl.md\":\"16c74e11\",\"fe-engineering_ci-gulp_index.md\":\"efd97b39\",\"fe-engineering_ci-gulp_workflow.md\":\"32545aae\",\"fe-engineering_ci-postcss_index.md\":\"d7bc7a90\",\"fe-engineering_ci-run-script_index.md\":\"d503c8b9\",\"fe-engineering_ci-vite_assets.md\":\"ff37df24\",\"fe-engineering_ci-vite_cli.md\":\"57e989f9\",\"fe-engineering_ci-vite_connect.md\":\"5c1d08d8\",\"fe-engineering_ci-vite_index.md\":\"9484b368\",\"fe-engineering_ci-vite_optimize.md\":\"b1989ac9\",\"fe-engineering_ci-vite_plugin.md\":\"16f38891\",\"fe-engineering_ci-vite_server.md\":\"7a9d0f4e\",\"fe-engineering_ci-vite_usage.md\":\"1c20b6a8\",\"fe-engineering_ci-webpack_asset.md\":\"98d5aab8\",\"fe-engineering_ci-webpack_config.md\":\"c8e8a473\",\"fe-engineering_ci-webpack_css.md\":\"abff2cf7\",\"fe-engineering_ci-webpack_dev.md\":\"b568ef6e\",\"fe-engineering_ci-webpack_entry.md\":\"5b4334df\",\"fe-engineering_ci-webpack_env.md\":\"a6b30b19\",\"fe-engineering_ci-webpack_hmr.md\":\"cd46a0f6\",\"fe-engineering_ci-webpack_html.md\":\"bc344d9b\",\"fe-engineering_ci-webpack_index.md\":\"913f2e65\",\"fe-engineering_ci-webpack_intro.md\":\"7bb01ba5\",\"fe-engineering_ci-webpack_js.md\":\"dab764a5\",\"fe-engineering_ci-webpack_perf.md\":\"b8797cd6\",\"fe-engineering_ci-webpack_prod.md\":\"4a126de2\",\"fe-engineering_ci-webpack_webpack-chain.md\":\"f12f2a69\",\"fe-engineering_dev-debug_index.md\":\"b56b6176\",\"fe-engineering_dev-linter_editorconfig.md\":\"dc60f520\",\"fe-engineering_dev-linter_eslint.md\":\"63d441bd\",\"fe-engineering_dev-linter_husky.md\":\"69969d37\",\"fe-engineering_dev-linter_prettier.md\":\"ff7babd2\",\"fe-engineering_dev-linter_stylelint.md\":\"f81b38d8\",\"fe-engineering_dev-linter_git-commit.md\":\"d2df508e\",\"fe-engineering_dev-linter_index.md\":\"3cf77e37\",\"fe-engineering_dev-linter_lint-staged.md\":\"8cb70003\",\"fe-engineering_dev-linter_practice.md\":\"37a86048\",\"fe-engineering_dev-mock_index.md\":\"749cd5bb\",\"fe-engineering_dev-test_1-jest.md\":\"d9d07167\",\"fe-engineering_dev-test_2-jest-config.md\":\"4a6fc46b\",\"fe-engineering_dev-test_3-vue-test.md\":\"a091f9be\",\"fe-engineering_dev-test_4-vue-router-test.md\":\"49f71185\",\"fe-engineering_dev-test_5-vuex-test.md\":\"5c96d044\",\"fe-engineering_dev-test_6-vue-ssr-test.md\":\"7b5297c7\",\"fe-engineering_dev-test_7-snapshot-test.md\":\"3d735cd6\",\"fe-engineering_dev-test_index.md\":\"beae85ae\",\"fe-engineering_initial_browserslist.md\":\"a33fc58b\",\"fe-engineering_initial_cli.md\":\"4e4e190e\",\"fe-engineering_initial_dev-env.md\":\"d82da388\",\"fe-engineering_initial_package-json.md\":\"b8617281\",\"fe-engineering_initial_project-directory.md\":\"b90d8411\",\"fe-engineering_intro-fe-engineering.md\":\"7e295cb8\",\"fe-engineering_op-monitor_index.md\":\"e2ed34ea\",\"fe-engineering_op-performance_index.md\":\"3679bf00\",\"fe-framework_element-ui_index.md\":\"c582cdaa\",\"fe-framework_react_create-react-app.md\":\"f7bbcaec\",\"fe-framework_react_index.md\":\"50f9db3b\",\"fe-framework_react_react-00-catalog.md\":\"307aca31\",\"fe-framework_react_react-01-what_is_react.md\":\"86116245\",\"fe-framework_react_react-02-react-createelement.md\":\"6b3404a6\",\"fe-framework_react_react-03-组件类.md\":\"554059f4\",\"fe-framework_react_react-04-组件属性传递props.md\":\"01ccbffa\",\"fe-framework_react_react-05-组件嵌套props.children.md\":\"0d5954fc\",\"fe-framework_react_react-06-组件属性默认值defaultprops.md\":\"ae07649e\",\"fe-framework_react_react-07-组件属性值类型校验propstypes.md\":\"560ae13a\",\"fe-framework_react_react-08-组件状态state.md\":\"d5cf0823\",\"fe-framework_react_react-09-有状态组件和无状态组件.md\":\"ffaa3704\",\"fe-framework_react_react-10-组件的事件.md\":\"71f360df\",\"fe-framework_react_react-11-react事件内幕syntheticevent.md\":\"9c6543be\",\"fe-framework_react_react-12-组件生命周期lifycycle.md\":\"6e860a5c\",\"fe-framework_react_react-13-jsx体验.md\":\"f568eed1\",\"fe-framework_react_react-14-jsx语法.md\":\"be33f687\",\"fe-framework_react_react-15-react使用表单.md\":\"3c168408\",\"fe-framework_react_react-16-高阶组件hoc.md\":\"9ff895b2\",\"fe-framework_react_react-17-创建react项目的三种方法.md\":\"f92b7c17\",\"fe-framework_react_react-hooks.md\":\"f4f5e3e7\",\"fe-framework_react_react-redux-01-what_is_redux.md\":\"06dbe9fb\",\"fe-framework_react_react-router-01-路由react-router原理.md\":\"2ed5868b\",\"fe-framework_react_react-router-02-react-router-v4.md\":\"37242ac9\",\"fe-framework_react_react-router-03-路由react-router的api.md\":\"996b6b7e\",\"fe-framework_vue_index.md\":\"7a840488\",\"fe-framework_vue_vite_index.md\":\"c4452025\",\"fe-framework_vue_vue-router_vue-router-1-index.md\":\"a0b2ea17\",\"fe-framework_vue_vue-router_vue-router-2-evolution.md\":\"0b805dcc\",\"fe-framework_vue_vue-router_vue-router-3-usage.md\":\"b4b2e0eb\",\"fe-framework_vue_vue-ssr_vue-ssr-demo.md\":\"5a61aec3\",\"fe-framework_vue_vue-ssr_vue-ssr-index.md\":\"356b4f07\",\"fe-framework_vue_vue-ssr_vue-ssr-intro.md\":\"63b07f08\",\"fe-framework_vue_vue-tutorial_vue-1-why-use-vue.md\":\"e6237261\",\"fe-framework_vue_vue-tutorial_vue-10-template-v-bind-with-class-and-style.md\":\"74da468d\",\"fe-framework_vue_vue-tutorial_vue-11-js-vue-options.md\":\"0765b40e\",\"fe-framework_vue_vue-tutorial_vue-12-js-data.md\":\"cf9d2e3b\",\"fe-framework_vue_vue-tutorial_vue-13-js-computed.md\":\"e2b88707\",\"fe-framework_vue_vue-tutorial_vue-14-js-methods.md\":\"5ef7ccb1\",\"fe-framework_vue_vue-tutorial_vue-15-js-watch.md\":\"4884061a\",\"fe-framework_vue_vue-tutorial_vue-16-js-filters.md\":\"b6ba06d2\",\"fe-framework_vue_vue-tutorial_vue-17-js-mixins.md\":\"3ce8defc\",\"fe-framework_vue_vue-tutorial_vue-18-js-directive.md\":\"2340151a\",\"fe-framework_vue_vue-tutorial_vue-19-js-lifecycle.md\":\"fcf5bf3d\",\"fe-framework_vue_vue-tutorial_vue-2-template-directive.md\":\"d18c9c95\",\"fe-framework_vue_vue-tutorial_vue-20-js-ref.md\":\"46dcde3c\",\"fe-framework_vue_vue-tutorial_vue-21-js-data-computed-watch-methods-filters.md\":\"2da97dcd\",\"fe-framework_vue_vue-tutorial_vue-22-vue-scope.md\":\"e9c62f41\",\"fe-framework_vue_vue-tutorial_vue-23-js-nexttick.md\":\"34929799\",\"fe-framework_vue_vue-tutorial_vue-24-component.md\":\"eca0953d\",\"fe-framework_vue_vue-tutorial_vue-25-component-introduce.md\":\"593cc794\",\"fe-framework_vue_vue-tutorial_vue-26-component-prop.md\":\"1dd72bd1\",\"fe-framework_vue_vue-tutorial_vue-27-component-event.md\":\"7fc74cc1\",\"fe-framework_vue_vue-tutorial_vue-28-component-slot.md\":\"d795a98b\",\"fe-framework_vue_vue-tutorial_vue-29-component-ref.md\":\"c6966476\",\"fe-framework_vue_vue-tutorial_vue-3-template-插值-v-html.md\":\"a5e39e3f\",\"fe-framework_vue_vue-tutorial_vue-30-component-组件间通信6种方法.md\":\"b0a04c2b\",\"fe-framework_vue_vue-tutorial_vue-31-component-异步组件-工厂函数.md\":\"490e0177\",\"fe-framework_vue_vue-tutorial_vue-32-component-transition.md\":\"db924e1c\",\"fe-framework_vue_vue-tutorial_vue-33-component-keep-alive.md\":\"1ecc445f\",\"fe-framework_vue_vue-tutorial_vue-34-component-is.md\":\"9bf8d419\",\"fe-framework_vue_vue-tutorial_vue-36-component-provide-inject.md\":\"864ee3f9\",\"fe-framework_vue_vue-tutorial_vue-4-template-v-if-and-v-show.md\":\"03b587a4\",\"fe-framework_vue_vue-tutorial_vue-5-template-v-for.md\":\"e52b2a9e\",\"fe-framework_vue_vue-tutorial_vue-6-template-v-bind.md\":\"97a2ff6b\",\"fe-framework_vue_vue-tutorial_vue-7-template-v-on-and-modifier.md\":\"5ea5a7db\",\"fe-framework_vue_vue-tutorial_vue-8-template-v-model.md\":\"23ece59b\",\"fe-framework_vue_vue-tutorial_vue-9-template-render-jsx.md\":\"fe418f65\",\"fe-framework_vue_vue-tutorial_vue-practice-2-jsx.md\":\"33230994\",\"fe-framework_vue_vue-tutorial_vue-practice-3-watch-selector.md\":\"0313565c\",\"fe-framework_vue_vue-vuex_vuex-1-index.md\":\"00c91180\",\"fe-framework_vue_vue-vuex_vuex-2-usage.md\":\"151dee5c\",\"fe-framework_vue-technology-source-code_index.md\":\"503b9253\",\"fe-framework_vue-technology-source-code_vue-router-source-code-1-install.md\":\"7a176090\",\"fe-framework_vue-technology-source-code_vue-router-source-code-2-init.md\":\"a20c4e86\",\"fe-framework_vue-technology-source-code_vue-router-source-code-3-matcher.md\":\"3ff4baba\",\"fe-framework_vue-technology-source-code_vue-router-source-code-4-history.md\":\"5566949d\",\"fe-framework_vue-technology-source-code_vue-router-source-code-5-router-link.md\":\"0f2c5dde\",\"fe-framework_vue-technology-source-code_vue-router-source-code-6-router-view.md\":\"936e42e1\",\"fe-framework_vue-technology-source-code_vue-source-code-0-index.md\":\"b37434f8\",\"fe-framework_vue-technology-source-code_vue-source-code-1-reactivity-1-detection-chnage.md\":\"3f82fb99\",\"fe-framework_vue-technology-source-code_vue-source-code-1-reactivity-2-collect-dependency.md\":\"2db397af\",\"fe-framework_vue-technology-source-code_vue-source-code-1-reactivity-3-dispatch-update.md\":\"3c43fc62\",\"fe-framework_vue-technology-source-code_vue-source-code-1-reactivity-4-summary.md\":\"37429fdb\",\"fe-framework_vue-technology-source-code_vue-source-code-2-compile-0.md\":\"9c20bc02\",\"fe-framework_vue-technology-source-code_vue-source-code-2-compile-1-parse.md\":\"09160c17\",\"fe-framework_vue-technology-source-code_vue-source-code-2-compile-2-optimize.md\":\"b29d6ff1\",\"fe-framework_vue-technology-source-code_vue-source-code-2-compile-3-generate.md\":\"0e241f63\",\"fe-framework_vue-technology-source-code_vue-source-code-3-virtual-dom-1-create-vnode.md\":\"9b59a3d9\",\"fe-framework_vue-technology-source-code_vue-source-code-3-virtual-dom-2-diff.md\":\"d1c7db7c\",\"fe-framework_vue-technology-source-code_vue-source-code-4-component-1-extend.md\":\"851325a7\",\"fe-framework_vue-technology-source-code_vue-source-code-4-component-2-createcomponent.md\":\"4dfbdef2\",\"fe-framework_vue-technology-source-code_vue-source-code-4-component-3-slot.md\":\"ef4c4283\",\"fe-framework_vue-technology-source-code_vue-source-code-4-component-4-async.md\":\"7174f7ad\",\"fe-framework_vue-technology-source-code_vue-source-code-4-component-5-keep-alive.md\":\"2b9e9910\",\"fe-framework_vue-technology-source-code_vue-source-code-5-initialize-1-constructor.md\":\"53aef4a1\",\"fe-framework_vue-technology-source-code_vue-source-code-5-initialize-2-mergeoptions.md\":\"200946fe\",\"fe-framework_vue-technology-source-code_vue-source-code-5-initialize-3-options.md\":\"d6337472\",\"fe-framework_vue-technology-source-code_vue-source-code-6-extension-1-lifecycle.md\":\"a86c2de0\",\"fe-framework_vue-technology-source-code_vue-source-code-6-extension-2-event.md\":\"c685721b\",\"fe-framework_vue-technology-source-code_vue-source-code-6-extension-3-nexttick.md\":\"96458e33\",\"fe-framework_vue-technology-source-code_vue-source-code-6-extension-4-directive.md\":\"04723bd9\",\"fe-framework_vue-technology-source-code_vue-source-code-6-extension-5-filter.md\":\"1cb7d6f8\",\"fe-framework_vue-technology-source-code_vue-ssr-source-code.md\":\"204e79ea\",\"fe-framework_vue-technology-source-code_vuex-source-code-1-install.md\":\"f1e5dab5\",\"fe-framework_vue-technology-source-code_vuex-source-code-2-instance.md\":\"a9075d94\",\"fe-framework_vue-technology-source-code_vuex-source-code-3-api.md\":\"ef442292\",\"fe-framework_vue-technology-source-code_vuex-source-code-4-register.md\":\"8a29fb17\",\"fe-framework_vue-technology-source-code_vuex-source-code-5-plugin.md\":\"06346282\",\"fe-language_css_index.md\":\"cd751a67\",\"fe-language_es_async-0-history.md\":\"0bf69669\",\"fe-language_es_async-1-promise.md\":\"c1f97267\",\"fe-language_es_async-2-generator-iterator.md\":\"a710847b\",\"fe-language_es_async-3-async-await.md\":\"8288aff1\",\"fe-language_es_async-4-js-callback-promise-generator-async.md\":\"32950af9\",\"fe-language_es_base-0-index.md\":\"abe21250\",\"fe-language_es_base-1-expression-operators.md\":\"9fd8b9e8\",\"fe-language_es_base-2-variant.md\":\"50ae4e66\",\"fe-language_es_base-3-statement.md\":\"27a8f403\",\"fe-language_es_base-4-strict.md\":\"c63fa31a\",\"fe-language_es_built-in-array.md\":\"3e178710\",\"fe-language_es_built-in-boolean.md\":\"51864999\",\"fe-language_es_built-in-date.md\":\"45ef161f\",\"fe-language_es_built-in-error.md\":\"018dc495\",\"fe-language_es_built-in-globalthis.md\":\"d7cf8660\",\"fe-language_es_built-in-map.md\":\"db834f19\",\"fe-language_es_built-in-number.md\":\"a2ec1b63\",\"fe-language_es_built-in-object.md\":\"35f15e0e\",\"fe-language_es_built-in-regexp.md\":\"4f433cd8\",\"fe-language_es_built-in-set.md\":\"63fd06e7\",\"fe-language_es_built-in-string.md\":\"79516f0f\",\"fe-language_es_built-in-weakmap-weakset.md\":\"1ec680ff\",\"fe-language_es_built-in-index.md\":\"8d2e4dc1\",\"fe-language_es_es-next-index.md\":\"7a43800d\",\"fe-language_es_fn-0-index.md\":\"090761ea\",\"fe-language_es_fn-1-intro.md\":\"38fb89de\",\"fe-language_es_fn-2-base.md\":\"29555541\",\"fe-language_es_fn-3-runtime.md\":\"03199e43\",\"fe-language_es_fn-4-senior.md\":\"4f5a2ce4\",\"fe-language_es_index.md\":\"c272d8d0\",\"fe-language_es_intro-1-software.md\":\"bec249ff\",\"fe-language_es_intro-2-es-history.md\":\"2bcde654\",\"fe-language_es_misc-1-error.md\":\"370ec2a2\",\"fe-language_es_misc-2-module.md\":\"6142641b\",\"fe-language_es_module-0-history.md\":\"46a6d856\",\"fe-language_es_module-1-commonjs.md\":\"35793950\",\"fe-language_es_module-2-amd-requirejs.md\":\"2c36e8fb\",\"fe-language_es_module-3-umd.md\":\"a7b21c33\",\"fe-language_es_module-4-es-module.md\":\"479f756f\",\"fe-language_es_oop-0-index.md\":\"f18b5174\",\"fe-language_es_oop-0-object-history.md\":\"8a9347dd\",\"fe-language_es_oop-1-object-create.md\":\"8a529ea0\",\"fe-language_es_oop-2-object-property.md\":\"2ef0b230\",\"fe-language_es_oop-3-prototype.md\":\"25b3b316\",\"fe-language_es_oop-4-constructor.md\":\"45bea2e8\",\"fe-language_es_oop-5-class.md\":\"84014c48\",\"fe-language_es_oop-6-inherit.md\":\"5d3bf731\",\"fe-language_es_type-0-index.md\":\"b1f2a475\",\"fe-language_es_type-1-null-undefined-boolean.md\":\"ce6c2a52\",\"fe-language_es_type-2-number.md\":\"e514d000\",\"fe-language_es_type-3-string.md\":\"5a189155\",\"fe-language_es_type-4-symbol.md\":\"5ee5c902\",\"fe-language_es_type-5-bigint.md\":\"6e48769e\",\"fe-language_es_type-6-object.md\":\"c572a0b8\",\"fe-language_es_type-7-checking.md\":\"229f555c\",\"fe-language_es_type-8-primitive-wrapper.md\":\"fe3140e8\",\"fe-language_es_type-9-conversion.md\":\"be72c62c\",\"fe-language_html_0-introduce.md\":\"cfce7a5f\",\"fe-language_html_1-grammar.md\":\"496f669a\",\"fe-language_html_10-text-content-semantics.md\":\"aef2512c\",\"fe-language_html_11-a.md\":\"c4edeaec\",\"fe-language_html_12-img.md\":\"0f19d19a\",\"fe-language_html_13-table.md\":\"86f9a2ee\",\"fe-language_html_14-form.md\":\"d0536ba6\",\"fe-language_html_15-template.md\":\"2886c50b\",\"fe-language_html_2-content-model.md\":\"96fd2e22\",\"fe-language_html_3-doc-structure.md\":\"83a71ae2\",\"fe-language_html_4-doctype.md\":\"d123deb1\",\"fe-language_html_5-html.md\":\"e035b95e\",\"fe-language_html_6-head.md\":\"7e724552\",\"fe-language_html_7-body.md\":\"969b9329\",\"fe-language_html_8-layout-structural-semantics.md\":\"7e62304f\",\"fe-language_html_9-text-structural-semantics.md\":\"f1ce442f\",\"fe-language_html_index.md\":\"1d022575\",\"fe-language_html_outerhtml-innerthml-outertext-innertext-textcontent.md\":\"8a3c8977\",\"fe-language_ts_0-introts.md\":\"3848bb6f\",\"fe-language_ts_1-type-declaration-1.1-basic-type.md\":\"b93467a0\",\"fe-language_ts_1-type-declaration-1.2-function.md\":\"52307538\",\"fe-language_ts_1-type-declaration-1.3-class.md\":\"c6a86837\",\"fe-language_ts_1-type-declaration-1.5-decorators.md\":\"782e9166\",\"fe-language_ts_2-type-inference.md\":\"37d86fe6\",\"fe-language_ts_3-type-checking.md\":\"5523d335\",\"fe-language_ts_4-type-programming.md\":\"4bac4b1b\",\"fe-language_ts_declaration.md\":\"b65203bf\",\"fe-language_ts_index.md\":\"5bb99e70\",\"fe-language_ts_install.md\":\"fc8e0952\",\"fe-language_ts_module.md\":\"4cba8f2d\",\"fe-language_ts_practice-enum.md\":\"3801cc93\",\"fe-language_ts_practice-ts-node.md\":\"c0dd5a0a\",\"fe-language_ts_practice-ts-vue.md\":\"920c1166\",\"fe-language_ts_tsconfig.md\":\"5bbd7785\",\"fe-language_ts_x-advancedtype.md\":\"d515fd6c\",\"fe-language_ts_x-basetype.md\":\"30468eb6\",\"fe-language_ts_x-generics.md\":\"ed8d3aaf\",\"fe-language_ts_x-interface.md\":\"72dcb4d3\",\"fe-language_ts_x-types.md\":\"3d9ea278\",\"fe-technology_backend-for-frontend_index.md\":\"d8cef06b\",\"fe-technology_micro-frontend_intro-micro-fe.md\":\"77ad1023\",\"fe-technology_micro-frontend_lerna.md\":\"c0cc202d\",\"fe-technology_micro-frontend_monorepo.md\":\"cabb3d3f\",\"fe-technology_responsive-web-design_index.md\":\"4c854ae5\",\"fe-technology_visualize_canvas_index.md\":\"6c33172b\",\"fe-technology_visualize_svg_index.md\":\"9653612c\",\"fe-technology_visualize_webgl_index.md\":\"00d73706\",\"network_eventsource.md\":\"8d0efe73\",\"network_websocket.md\":\"bbfce1b6\",\"network_xmlhttprequest.md\":\"a4f7b90c\",\"network_axios_1-instance.md\":\"791b5019\",\"network_axios_2-request-promise.md\":\"511f5f37\",\"network_axios_3-adapter.md\":\"a9370f1a\",\"network_axios_4-interceptor.md\":\"19712a95\",\"network_axios_5-transform-data.md\":\"f658bac9\",\"network_axios_6-cancel-token.md\":\"51cd03b5\",\"network_axios_index.md\":\"4f3a5b6a\",\"network_fetch_index.md\":\"cd637128\",\"network_graphql_index.md\":\"50e93f26\",\"network_protocol_dns.md\":\"dd7ff30f\",\"network_protocol_http-auth.md\":\"50879e5a\",\"network_protocol_http-authentication.md\":\"7d8030ee\",\"network_protocol_http-authorization.md\":\"a3350519\",\"network_protocol_http-cache.md\":\"4b0b0874\",\"network_protocol_http-cookie.md\":\"8fce19c0\",\"network_protocol_http-cors.md\":\"a17436d5\",\"network_protocol_http-intro.md\":\"b10a8444\",\"network_protocol_http-session-connect-message.md\":\"149be441\",\"network_protocol_http-uri-mime.md\":\"64272e5b\",\"network_protocol_index.md\":\"dc983831\",\"network_protocol_tcp-udp.md\":\"520a952e\",\"network_restful_index.md\":\"43353842\",\"server_bash_index.md\":\"9ed293cc\",\"server_connect_index.md\":\"a1725989\",\"server_express_index.md\":\"f876e0b1\",\"server_koa_index.md\":\"ec3b7633\",\"server_nest_index.md\":\"7fdd1963\",\"server_nginx_index.md\":\"8be3e7b9\",\"server_node_bit-byte-stream-buffer.md\":\"01aab59e\",\"server_node_buffer.md\":\"3db6b6c3\",\"server_node_concept.md\":\"50bb2909\",\"server_node_eventloop.md\":\"c65dabd6\",\"server_node_fs.md\":\"c4fb71cb\",\"server_node_global.md\":\"c1706784\",\"server_node_http.md\":\"2cf05909\",\"server_node_index.md\":\"452caf63\",\"server_node_introduce.md\":\"1e2806b4\",\"server_node_module.md\":\"ca9ffbb1\",\"server_node_npm.md\":\"4bf407af\",\"server_node_npx.md\":\"da5f74d1\",\"server_node_nrm.md\":\"dd8cef87\",\"server_node_nvm.md\":\"faf7ed3b\",\"server_node_path.md\":\"da13f9ce\",\"server_node_pnpm.md\":\"63d0a42a\",\"server_node_querystring.md\":\"72d59861\",\"server_node_stream.md\":\"3ac69443\",\"server_node_url.md\":\"56c34bb7\",\"server_node_yarn.md\":\"6e05d731\",\"software_algorithm_index.md\":\"f4069c5b\",\"software_architectural-pattern_index.md\":\"ba38f22c\",\"software_data-structure_index.md\":\"10c44ef2\",\"tools_git_git-flow.md\":\"b0d2f25d\",\"tools_git_index.md\":\"67fb6b5c\",\"tools_git_install.md\":\"c39795ce\",\"tools_git_usage.md\":\"49547cc7\",\"tools_node-tree-cli.md\":\"dee9e020\",\"tools_powershell.md\":\"8a750fdf\",\"tools_vim_concept.md\":\"a4ec8baf\",\"tools_vim_index.md\":\"d1342faf\",\"tools_vim_install.md\":\"be3b423b\",\"tools_vim_shortcuts.md\":\"6e18cb6d\",\"tools_vscode.md\":\"f3f7ed19\",\"tools_window-terminal.md\":\"bcfcfaff\",\"index.md\":\"1f5b57dd\"}")</script>
    <script type="module" async src="/assets/app.f1e974b0.js"></script>
    
  </body>
</html>